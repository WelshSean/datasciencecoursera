---
title: "Automatic or Manual Transmissions - Which is best?"
author: "Sean Clarke"
date: "17 August 2015"
output: pdf_document
---

```{r cache = F, echo = F, message = F, warning = F, tidy = F, results='hide'}
# Setup data and libraries
data("mtcars")
library(ggplot2)
library(GGally)
library(dplyr)
library(ggfortify)
mtsaved <- mtcars # Save a copy of mtcars with no conversion to factors - needed by cor
mtcars <- mutate(mtcars, cyl = factor(cyl)) # convert cyl to a factor
mtcars <- mutate(mtcars, vs = factor(vs)) # convert cyl to a factor
mtcars <- mutate(mtcars, am = factor(am)) # convert cyl to a factor
mtcars <- mutate(mtcars, gear = factor(gear)) # convert cyl to a factor
```

# Exploratory Data Analysis

In order to understand the relationships between the different variables in the dataset a matrix of scatterplots was created as can be seen in Figure 1. This provided us with a means of getting a feel for how the variables depend on one another. As a result of this analysis and looking at the help page for the mtcars dataset it is clear that cyl (number of cylinders), vs (engine setup), am (automatic or manual gearbox) and gear (number of forward gears) are categorical variables and so they were converted to factors. **Note: For the variable am, 0 indicates automatic transmission, 1 indicates manual transmission.**

Additionlly, a correlation matrix was evaluated - the results are summarised in figure 2. If we define the threshold for significance to be Â±0.8 after rounding the figures to one decimal place, we see the following:

* mpg is strongly correlated with wt, disp, cyl and hp
* wt is strongly correlated with disp and cyl
* hp is strongly correlated with disp, cyl and carb

# Model Selection

It is well known that introducing multiple terms that have strong dependencies between them does not improve the quality of the fit. Additionally in this piece of work we are not looking at making predictions but rather in understanding the effect that an automated Vs Manual gearbox makes, so we favour a parsimonious model over an opaque one even if that is at the cost of this accuracy.

To this end, we propose to choose the variables that we include in our model based on how strongly they are correlated with mpg and discard variables from the resulting set based on strong mutual correlation. The exception to this is am which we include as it is the main motivation for this study! This means that we initially propose to include am, wt and hp in the fit. 

In order to understand how effective the propsoed choice of variables to include in the fit is, we initially fit a model mpg ~ am and then build a series of nested models, initially including the variables that we intend to include and then those that we propose to leave out based on the correlation analysys that we did in the previous section. These models when then be fed into and Anova analysis in order to enable us to understand the impact of including each team.

```{r echo = F, message = F, warning = F}
fit1  <- lm(mpg ~  am , mtcars)
fit2  <- lm(mpg ~ am + wt, mtcars)
fit3  <- lm(mpg ~ am + wt + hp, mtcars)
fit4  <- lm(mpg ~ am + wt + hp + disp, mtcars)
fit5  <- lm(mpg ~ am + wt + hp + disp + cyl , mtcars)
fit6  <- lm(mpg ~ am + wt + hp + disp + cyl + drat, mtcars)
fit7  <- lm(mpg ~ am + wt + hp + disp + cyl + drat + qsec, mtcars)
fit8  <- lm(mpg ~ am + wt + hp + disp + cyl + drat + qsec + vs, mtcars)
fit9  <- lm(mpg ~ am + wt + hp + disp + cyl + drat + qsec + vs + gear, mtcars)
fit10 <- lm(mpg ~ am + wt + hp + disp + cyl + drat + qsec + vs + gear + carb, mtcars)
anova(fit1, fit2, fit3, fit4, fit5, fit6, fit7, fit8, fit9, fit10)
```

We clearly see that adding wt and hp into the model results in a large change in the Residual Sum of Squares(RSS), large F values and p values that are clearly insigficant which indicates that these terms definitely improve the fit. When we add the other terms into the fit, the RSS changes are much smaller and the F-values and p values dont suggest that we should include these terms.

The one possible exception to this is when we add in cyl, however even the effect of including cyl is four times as small as adding the proposed terms so we do not include it. We will further analyse the quality of our fit to validate this choice

# Results Analysis

## Qualitative analysys

The values of the mean of mpg for automatic (`r round(mean(mtcars[ mtcars$am == 0, ]$mpg), digits=1)`) and manual (`r round(mean(mtcars[ mtcars$am == 1, ]$mpg), digits=1)`) cars suggests that cars with a manual transmission have a `r round((mean(mtcars[ mtcars$am == 1, ]$mpg) - mean(mtcars[ mtcars$am == 0, ]$mpg))/mean(mtcars[ mtcars$am == 0, ]$mpg) *100, digits=1)`% higher mpg value than automatic vehicles. The Boxplot shown in figure 4 also backs up this assertion - the mean value for mpg for manual vehicles is higher than the top of the third quartile for automatic vehicles.

## Quantitative Analysis


# Appendix - Plots

## Figure1: Scatterplot matrix for all the variables in the mtcars dataset"

```{r, fig.width=12, fig.height=10,echo = F, message = F, warning = F, tidy = F, results='hide'}
pairs(mpg~.,data=mtcars, 
      main="Scatterplot matrix for all the variables in the mtcars dataset")
```

## Figure 2: Correlation matrix for all the variables in the mtcars dataset

```{r, fig.width=10, fig.height=8,echo = F, message = F, warning = F, tidy = F, results='hide'}
library(corrplot)
M <- cor(mtsaved)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(M, type = "upper", addCoef.col = "black", method = "shade", shade.col = NA, tl.col = "black", tl.srt = 45, col=col(200),  order = "AOE", title = "Correlation matrix for all the variables in the mtcars dataset")
```

## Figure 3: Standard R lm fit diagnostics for the fit that we chose to model mpg



```{r, fig.width=12, fig.height=10, echo = F, message = F, warning = F, tidy = F, results='hide'}
autoplot(fit3, data=mtcars, colour='am', which = 1:6, ncol = 2) 
```

## Figure 4: Boxplot showing how mpg depends on am in the mtcars dataset

```{r, fig.width=12, fig.height=10, echo = F, message = F, warning = F, tidy = F, results='hide'}
qplot(am, mpg, data=mtcars, geom=c("boxplot", "point"), 
   fill=am, main="Mileage by Transmission Type (0=automatic, 1=manual)",
   xlab="", ylab="Miles per Gallon")
```
