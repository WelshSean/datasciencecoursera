---
title: "Automatic or Manual Transmissions - Which is best?"
author: "Sean Clarke"
date: "17 August 2015"
output: pdf_document
---

```{r cache = F, echo = F, message = F, warning = F, tidy = F, results='hide'}
# Setup data and libraries
data("mtcars")
library(ggplot2)
library(GGally)
library(dplyr)
mtsaved <- mtcars # Save a copy of mtcars with no conversion to factors - needed by cor
mtcars <- mutate(mtcars, cyl = factor(cyl)) # convert cyl to a factor
mtcars <- mutate(mtcars, vs = factor(vs)) # convert cyl to a factor
mtcars <- mutate(mtcars, am = factor(am)) # convert cyl to a factor
mtcars <- mutate(mtcars, gear = factor(gear)) # convert cyl to a factor
```

## Exploratory Data Analysis

In order to understand the relationships between the different variables in the dataset a correlation matrix was evaluated - the results are summarise in figure one. If we define the threshold for significance to be Â±0.8 after rounding the figures to one decimal place, we see the following:

* mpg is strongly correlated with wt, disp, cyl and hp
* wt is strongly correlated with disp and cyl
* hp is strongly correlated with disp, cyl and carb

It is well known that introducing multiple terms that have strong dependencies between them does not improve the quality of the fit. Additionally in this piece of work we are not looking at making predictions but rather in understanding the effect that an automated Vs Manual gearbox makes, so we favour a parsimonious model over an opaque one even if that is at the cost of this accuracy.

To this end, we propose to choose the variables that we include in our model based on how strongly they are correlated with mpg and discard variables from the resulting set based on strong mutual correlation. The exception to this is am which we include as it is the main motivation for this study! This means that we initially propose to include am, wt and hp in the fit. 

 

From the calculated correlation values for the continuous variables, we see some positive correlation between fuel consumption and the rear axel ratio and 1/4 mile time. We see strong negative correlation between fuel consumption and Displacement, Horsepower, and weight. There is a weaker negative correlation between fuel consumption and the number of carburetors.

Interestingly (and maybe not surprisingly) fuel consumtions appears to depend in almost all the other factors!

# Model Selection

In order to find the optimal fit, we proceed to fit nested models, we will then proceed to evaluate an ANOVA for these fits and use the output of the F-Test to identify the necessary terms.

```{r}
fit1 <- lm(mpg ~  am , mtcars)
fit2 <- lm(mpg ~ am + wt, mtcars)
fit3 <- lm(mpg ~ am + wt + disp, mtcars)
fit4 <- lm(mpg ~ am + wt + disp + cyl, mtcars)
fit5 <- lm(mpg ~ am + wt + disp + cyl + drat, mtcars)
fit6 <- lm(mpg ~ am + wt + disp + cyl + drat + qsec, mtcars)
fit7 <- lm(mpg ~ am + wt + disp + cyl + drat + qsec + vs, mtcars)
fit8 <- lm(mpg ~ am + wt + disp + cyl + drat + qsec + vs + gear, mtcars)
fit9 <- lm(mpg ~ am + wt + disp + cyl + drat + qsec + vs + gear + carb, mtcars)
fit10 <- lm(mpg ~ am + wt + disp + cyl + drat + qsec + vs + gear + carb + hp, mtcars)
anova(fit1, fit2, fit3, fit4, fit5, fit6, fit7, fit8, fit9, fit10)
```

```{r}
fit1 <- lm(mpg ~  am , mtcars)
fit2 <- lm(mpg ~  am + wt + hp , mtcars)
fit3 <- lm(mpg ~  am + wt + hp + cyl + disp , mtcars)
fit4  <- lm(mpg ~  am + wt + hp + cyl + disp + gear + carb , mtcars)
fit5  <- lm(mpg ~  am + wt + hp + cyl + disp + gear + carb + vs + qsec , mtcars)
anova(fit1, fit2, fit3, fit4, fit5 )
```

```{r}
fit1 <- lm(mpg ~  am , mtcars)
fit2 <- lm(mpg ~  am + wt + hp , mtcars)
fit3 <- lm(mpg ~  am + wt + hp + cyl + disp , mtcars)
fit4  <- lm(mpg ~  am + wt + hp + cyl + disp + gear + carb , mtcars)
fit5  <- lm(mpg ~  am + wt + hp + cyl + disp + gear + carb + vs + qsec , mtcars)
anova(fit1, fit2, fit3, fit4, fit5 )
```

# Appendix - Plots

```{r, fig.width=10, fig.height=8,echo = F, message = F, warning = F, tidy = F, results='hide'}
library(corrplot)
M <- cor(mtsaved)
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
corrplot(M, type = "upper", addCoef.col = "black", method = "shade", shade.col = NA, tl.col = "black", tl.srt = 45, col=col(200),  order = "AOE", title = "Figure 1: Correlation matrix for all the variables in the mtcars dataset")
```
