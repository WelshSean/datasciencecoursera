---
title: "Investigation into the Exponential Distribution and the Central Limit Theorem"
output: pdf_document
geometry: margin=2cm
---
```{r echo=FALSE}
# Loading libraries
library(ggplot2)
```

# Overview

This report is a brief study intended to investigate how the exponential distribution adheres to the **Central Limit Theorem(CLT)**. The CLT states that the distribution of the sum (or mean) of a large number of independent, identically distributed variables will be approximately normal irrespective of the underlying distribution.

# Simulations

We now proceed to perform simulations to investigate how the sample mean and variance approximate the population variance and  mean. We take mutltiple samples of the mean of 40 exponentials.From the central limit theorem, we would expect:


$$E[\overline{X}] = \mu_{Pop}$$ 

$$Var[\overline{X}] = \sigma^{2}_{Pop}/n$$

The Exponential distribution has PDF

$$  f(x, \lambda)=\begin{cases}
    \lambda e^{-\lambda x}, & \text{if $x>=0$}.\\
    0, & \text{if $x<0$}.
  \end{cases}$$
  
where

$$ E[X] = 1/\lambda $$
$$ Var[X] = 1/\lambda^{2} $$

In this analysis we calculate the exponentials using the R function $rexp(n, \lambda)$ where we fix $\lambda = 0.2$. Firstly we generate the data set.

```{r}
numberSims <-  1000
numberexps <- 1000
numberMeans <- 40
numberMeans2 <- 200
lambda <- 0.2
mns <- NULL
exps <- NULL
for (i in 1 : numberSims) {mns <- c(mns, mean(rexp(numberMeans,lambda)))}
for (i in 1 : numberexps) {exps <- c(exps, rexp(numberMeans,lambda))}
```

```{r fig.width=5, fig.height=2.5}
expdist <- function(x, lbd = 0) {lbd * exp(-1 * lbd *x)}
expsdf <- as.data.frame(exps)
ggplot(data=expsdf, aes(x=exps)) + geom_histogram(aes(y = ..density..), colour="black", fill="white", binwidth = 0.4) +
   stat_function(fun=expdist, arg=list(lbd=lambda ), colour="red" ) +
  ggtitle("Histogram of 40000 observations of an exponential distribution \n with lamdba=0.2 and the exact PDF (red line)") + xlab("x") + ylab ("f(x,lambda)")
```

## Sample Mean versus Theoretical Mean 

Initially we consider comparison between the mean calculated from the data set and what the mean should be according to the CLT. So according to the CLT, for a sufficiently large data set, the sample means should follow a normal distribution with mean $\mu$, for the exponential distribution:

$$ E[\overline{X}] = \mu = 1/\lambda$$

Then we proceed to calculate the mean of dataset

```{r}
theoretical_mean <- 1/lambda
theoretical_mean
sample_mean <- mean(mns)
sample_mean
```

So we the mean calculated in the simulation is very close to the theoretical mean.

## Sample Variance versus Theoretical Variance

According to the CLT, the variance for means of an Exponential distribution is given by

$$ V[\overline{X}] = \sigma^{2}/n = (1/\lambda)^{2}/n = 1/\lambda^{2}n = $$

```{r}
theoretical_variance <- 1/(lambda^2*numberMeans)
theoretical_variance
sample_variance <- var(mns)
sample_variance
```

Again we see that the theoretical mean is very close to that obtained from the simulation.

## Comparison of sample date with the corresponding Normal Distribution

```{r fig.width=5, fig.height=2.5}
mnsdf <- as.data.frame(mns)
ggplot(data=mnsdf, aes(x=mns)) + geom_histogram(aes(y = ..density..), 
          colour="black", fill="white", binwidth = 0.1) +
  geom_vline(xintercept = (1/lambda), colour="green") + 
  geom_vline(xintercept = mean(mns), colour="blue") +
     stat_function(fun=dnorm, arg=list(mean=1/lambda, 
    sd=sqrt(1/(lambda^2*numberMeans)) ), colour="red" ) + 
  ggtitle("Histogram of 1000 simulations of the mean of 40 observations from \n
           an exponential distribution and corresponding theoretical \n
          normal density function") + xlab("x")
```

This shows that the distribution of the means certainly appears to have a Gaussian form and as we have seen above, the mean and variance obtained from the simulated data are very close to that predicted by the CLT. Now we can see that the distribution is still a little bit skewed, this comes from the combination of the exponential distribution being skewed and the relatively small number of samples used in the simulation. If we up the number of samples then we will see an improved fit.
```{r fig.width=5, fig.height=2.5}
mns2 <- NULL
for (i in 1 : numberSims) {mns2 <- c(mns2, mean(rexp(numberMeans2,lambda)))}
mnsdf2 <- as.data.frame(mns2)
ggplot(data=mnsdf2, aes(x=mns2)) + geom_histogram(aes(y = ..density..), 
      colour="black", fill="white", binwidth = 0.1) +
  stat_function(fun=dnorm, arg=list(mean=1/lambda, sd=sqrt(1/(lambda^2*numberMeans2)) ), 
                colour="red" )  + 
  ggtitle("Histogram of 1000 simulations of the mean of 200 observations from \n
           an exponential distribution and corresponding theoretical \n
          normal density function") + xlab("x")
```

This is also reflected in the means ans variance

```{r}
c(1/lambda,mean(mns2))
c(1/(lambda^2*numberMeans2), var(mns2))
```

